# Auto IP2Region æ™ºèƒ½åŒ–çš„IPåœ°ç†ä½ç½®è§£æåº“
<div align="center">

  [![License](https://img.shields.io/badge/license-Apache%202-blue.svg)](https://www.apache.org/licenses/LICENSE-2.0)
  [![Java](https://img.shields.io/badge/Java-17+-brightgreen.svg)](https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html)
  [![Release](https://img.shields.io/badge/release-v1.0.0-orange.svg)](https://github.com/listener-He/auto-ip2region/releases)
  [![GitHub](https://img.shields.io/github/license/listener-He/auto-ip2region?color=blue)](https://github.com/listener-He/auto-ip2region/blob/main/LICENSE)
  [![GitHub stars](https://img.shields.io/github/stars/listener-He/auto-ip2region)](https://github.com/listener-He/auto-ip2region/stargazers)
  [![GitHub issues](https://img.shields.io/github/issues/listener-He/auto-ip2region)](https://github.com/listener-He/auto-ip2region/issues)

</div>

<br/>

Auto IP2Region æ˜¯ä¸€ä¸ªæ™ºèƒ½åŒ–çš„IPåœ°å€åœ°ç†ä¿¡æ¯è§£æåº“ï¼Œå®ƒç»“åˆäº†æœ¬åœ°æ•°æ®åº“å’Œå¤šä¸ªå…è´¹åœ¨çº¿APIæœåŠ¡ï¼Œé€šè¿‡æ™ºèƒ½è´Ÿè½½å‡è¡¡å’Œè‡ªåŠ¨æ•…éšœè½¬ç§»æœºåˆ¶ï¼Œä¸ºæ‚¨æä¾›å‡†ç¡®ã€å¯é çš„IPåœ°ç†ä½ç½®ä¿¡æ¯æŸ¥è¯¢æœåŠ¡ã€‚

## ğŸ¯ è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°ä»¥ä¸‹ç—›ç‚¹ï¼š

| é—®é¢˜ | ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆ | Auto IP2Region è§£å†³æ–¹æ¡ˆ |
|------|-------------|---------------------|
| å•ä¸€æ•°æ®æºä¸ç¨³å®š | å›ºå®šä½¿ç”¨æŸä¸ªAPI | å¤šæ•°æ®æºæ™ºèƒ½åˆ‡æ¢            |
| æŸ¥è¯¢æ€§èƒ½å·® | åŒæ­¥é˜»å¡è°ƒç”¨ | çƒ­ç‚¹ç¼“å­˜å¤„ç†              |
| é™æµå¯¼è‡´å¤±è´¥ | é‡è¯•æœºåˆ¶ | æ™ºèƒ½è´Ÿè½½å‡è¡¡              |
| æ•°æ®å‡†ç¡®æ€§ä½ | æ— æ³•éªŒè¯æ•°æ®è´¨é‡ | åŸºäºæˆåŠŸç‡åŠ¨æ€è°ƒæ•´           |

## âœ¨ æ ¸å¿ƒç‰¹æ€§

<div align="center">
  <img src="feature.png" alt="features" />
</div>

### âš¡ é«˜æ€§èƒ½
- åŸºäº[ip2region](https://github.com/lionsoul2014/ip2region)æœ¬åœ°æ•°æ®åº“ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¯è¾¾**å¾®ç§’çº§**
- ä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ”¯æ’‘æ•°æ®å‡†ç¡®æ€§
- å†…ç½®Guava Cacheç¼“å­˜æœºåˆ¶ï¼Œçƒ­ç‚¹æ•°æ®è®¿é—®æ€§èƒ½æå‡**80%+**

### ğŸ”„ æ™ºèƒ½è´Ÿè½½å‡è¡¡
ç‹¬ç‰¹çš„åŠ æƒè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œç»¼åˆè€ƒè™‘ï¼š
- **æƒé‡**(40%) - é™æ€é…ç½®ä¼˜å…ˆçº§
- **æˆåŠŸç‡**(25%) - åŠ¨æ€å†å²æˆåŠŸç‡
- **æ‰§è¡Œæ¬¡æ•°**(20%) - è¯·æ±‚å‡åŒ€åˆ†å¸ƒ
- **å¯ç”¨æ€§**(15%) - åŸºäºé™æµçŠ¶æ€è¯„ä¼°

### ğŸ”§ å¤šæ•°æ®æºæ”¯æŒ
| ç±»å‹ | æ•°æ®æº | é»˜è®¤æƒé‡ | ç‰¹ç‚¹ |
|------|--------|------|-----|
| æœ¬åœ°æ•°æ®åº“ | ip2region | 50   | é«˜æ€§èƒ½ï¼Œæ— éœ€ç½‘ç»œ |
| å…è´¹API | æ·˜å®IPåº“ | 90   | å›½å†…IPå‡†ç¡®ç‡é«˜ |
| å…è´¹API | ipapi.co | 80   | å›½é™…IPè¦†ç›–å¹¿ |
| å…è´¹API | å¤ªå¹³æ´‹ç½‘ç»œ | 85   | ä¸­ç­‰æƒé‡ |
| å…è´¹API | IP9 | 75   | å¤‡ç”¨æ•°æ®æº |
| å…è´¹API | IPInfo | 70   | é™„åŠ ä¿¡æ¯ä¸°å¯Œ |
| å…è´¹API | XXLB | 70   | å¤‡ç”¨æ•°æ®æº |

### ğŸ›¡ï¸ è‡ªåŠ¨æ•…éšœè½¬ç§»
- å®æ—¶ç›‘æ§å„æ•°æ®æºå¥åº·çŠ¶å†µ
- è‡ªåŠ¨é™çº§åˆ°æœ¬åœ°æ•°æ®åº“
- æ™ºèƒ½æ¢å¤æœºåˆ¶ï¼Œæ•…éšœæ¢å¤åè‡ªåŠ¨å¯ç”¨

### ğŸ“ˆ å¯è§‚æµ‹æ€§
- å®æ—¶ç»Ÿè®¡å„æ•°æ®æºæˆåŠŸç‡
- ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§
- æ‰§è¡Œæ¬¡æ•°å’Œé™æµæƒ…å†µè·Ÿè¸ª

## ğŸ“Š æ•°æ®æºè¯¦ç»†é…ç½®

### æœ¬åœ°æ•°æ®æº

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|--------|-----|
| é™æµé€Ÿç‡ | 1000 QPS | æ¯ç§’æŸ¥è¯¢æ•°é™åˆ¶ |
| æƒé‡ | 100 | æœ€é«˜ä¼˜å…ˆçº§ |
| åç§° | LocalIp2Region | æ•°æ®æºæ ‡è¯† |

### ç½‘ç»œAPIæ•°æ®æº

| æ•°æ®æº | é™æµé€Ÿç‡(QPS) | æƒé‡ | åç§° |
|--------|---------------|------|------|
| æ·˜å®IPåº“ | 100 | 90 | TaobaoAPI |
| ipapi.co | 100 | 80 | IpApiCo |
| å¤ªå¹³æ´‹ç½‘ç»œ | 100 | 85 | Pacific |
| IP9 | 100 | 75 | IP9 |
| IPInfo | 100 | 70 | IPInfo |
| XXLB | 100 | 70 | XXLB |

## ğŸ§  è´Ÿè½½å‡è¡¡ç®—æ³•è¯¦è§£

Auto IP2Regioné‡‡ç”¨å…ˆè¿›çš„åŠ æƒè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œç»¼åˆè€ƒè™‘å¤šä¸ªç»´åº¦æ¥é€‰æ‹©æœ€ä¼˜çš„æ•°æ®æºï¼š

### ç®—æ³•å…¬å¼

```
æœ€ç»ˆå¾—åˆ† = æƒé‡å¾—åˆ† Ã— 0.4 + æˆåŠŸç‡å¾—åˆ† Ã— 0.25 + æ‰§è¡Œæ¬¡æ•°å¾—åˆ† Ã— 0.2 + å¯ç”¨æ€§å¾—åˆ† Ã— 0.15
```

### å„ç»´åº¦è®¡ç®—æ–¹å¼

#### 1. æƒé‡å¾—åˆ† (Weight Score)
```
æƒé‡å¾—åˆ† = æ•°æ®æºæƒé‡ / æ‰€æœ‰å¯ç”¨æ•°æ®æºä¸­çš„æœ€é«˜æƒé‡
```

#### 2. æˆåŠŸç‡å¾—åˆ† (Success Rate Score)
```
æˆåŠŸç‡å¾—åˆ† = æ•°æ®æºå†å²æˆåŠŸç‡ (0-1ä¹‹é—´)
```

#### 3. æ‰§è¡Œæ¬¡æ•°å¾—åˆ† (Execution Count Score)
```
æ‰§è¡Œæ¬¡æ•°å¾—åˆ† = 1 - (å½“å‰æ•°æ®æºæ‰§è¡Œæ¬¡æ•° / æ‰€æœ‰å¯ç”¨æ•°æ®æºçš„æœ€å¤§æ‰§è¡Œæ¬¡æ•°)
```

#### 4. å¯ç”¨æ€§å¾—åˆ† (Availability Score)
åŸºäºé™æµå™¨çš„ç­‰å¾…æ—¶é—´è¯„ä¼°æ•°æ®æºå¯ç”¨æ€§ï¼š
- æ— è¯·æ±‚æ—¶ï¼š1.0
- ç­‰å¾… < 10msï¼š0.9
- ç­‰å¾… 10-100msï¼š0.7
- ç­‰å¾… 100-500msï¼š0.5
- ç­‰å¾… > 500msï¼š0.3

### è½®è¯¢ç¤ºä¾‹

å‡è®¾æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ•°æ®æºï¼š

| æ•°æ®æº | æƒé‡ | æˆåŠŸç‡ | æ‰§è¡Œæ¬¡æ•° | å¯ç”¨æ€§ |
|--------|------|--------|----------|--------|
| æœ¬åœ°æ•°æ®åº“ | 100 | 0.99 | 1000 | 1.0 |
| æ·˜å®API | 90 | 0.95 | 500 | 0.9 |
| ipapi.co | 80 | 0.85 | 200 | 0.7 |

è®¡ç®—å„æ•°æ®æºå¾—åˆ†ï¼š

1. **æœ¬åœ°æ•°æ®åº“**ï¼š
   - æƒé‡å¾—åˆ† = 100/100 = 1.0
   - æˆåŠŸç‡å¾—åˆ† = 0.99
   - æ‰§è¡Œæ¬¡æ•°å¾—åˆ† = 1 - (1000/1000) = 0
   - å¯ç”¨æ€§å¾—åˆ† = 1.0
   - æœ€ç»ˆå¾—åˆ† = 1.0Ã—0.4 + 0.99Ã—0.25 + 0Ã—0.2 + 1.0Ã—0.15 = 0.7975

2. **æ·˜å®API**ï¼š
   - æƒé‡å¾—åˆ† = 90/100 = 0.9
   - æˆåŠŸç‡å¾—åˆ† = 0.95
   - æ‰§è¡Œæ¬¡æ•°å¾—åˆ† = 1 - (500/1000) = 0.5
   - å¯ç”¨æ€§å¾—åˆ† = 0.9
   - æœ€ç»ˆå¾—åˆ† = 0.9Ã—0.4 + 0.95Ã—0.25 + 0.5Ã—0.2 + 0.9Ã—0.15 = 0.8075

3. **ipapi.co**ï¼š
   - æƒé‡å¾—åˆ† = 80/100 = 0.8
   - æˆåŠŸç‡å¾—åˆ† = 0.85
   - æ‰§è¡Œæ¬¡æ•°å¾—åˆ† = 1 - (200/1000) = 0.8
   - å¯ç”¨æ€§å¾—åˆ† = 0.7
   - æœ€ç»ˆå¾—åˆ† = 0.8Ã—0.4 + 0.85Ã—0.25 + 0.8Ã—0.2 + 0.7Ã—0.15 = 0.7925

æ ¹æ®å¾—åˆ†æ’åºï¼Œé€‰æ‹©æ·˜å®APIä½œä¸ºæœ¬æ¬¡æŸ¥è¯¢çš„æ•°æ®æºã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“¦ Mavenä¾èµ– (ç­‰å¾…å‘å¸ƒ)

```xml
<dependency>
    <groupId>cn.hehouhui</groupId>
    <artifactId>auto-ip2region</artifactId>
    <version>1.0.0</version>
</dependency>
```

### ğŸ“– åŸºç¡€ä½¿ç”¨

#### 1. æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢ï¼ˆæ¨èï¼‰

```java
// åˆ›å»ºåªåŒ…å«æœ¬åœ°ip2regionæ•°æ®æºçš„æŸ¥è¯¢å¼•æ“
IpQueryEngine engine = IpQueryEngineFactory.createWithLocalSource(
    "path/to/ip2region.xdb",  // æ•°æ®åº“æ–‡ä»¶è·¯å¾„
    1000                      // é™æµé€Ÿç‡(æ¯ç§’è¯·æ±‚æ•°)
);

// æŸ¥è¯¢IPä¿¡æ¯
try {
    IpInfo info = engine.query("8.8.8.8");
    System.out.println(info);
    // è¾“å‡ºç¤ºä¾‹: IpInfo{country='ç¾å›½', region='åŠ åˆ©ç¦å°¼äºš', city='å±±æ™¯åŸ', isp='è°·æ­Œ'}
} catch (Exception e) {
    e.printStackTrace();
}
```

#### 2. æ··åˆæ•°æ®æºæŸ¥è¯¢

```java
// åˆ›å»ºå®Œæ•´çš„æ··åˆæ•°æ®æºæŸ¥è¯¢å¼•æ“ï¼ˆæœ¬åœ°+æ‰€æœ‰å…è´¹APIï¼‰
IpQueryEngine engine = IpQueryEngineFactory.createWithAllSources(
    "path/to/ip2region.xdb",  // ip2regionæ•°æ®åº“æ–‡ä»¶è·¯å¾„
    1000,  // æœ¬åœ°ip2regionæ•°æ®æºé™æµé€Ÿç‡
    100,   // æ·˜å®APIé™æµé€Ÿç‡
    100,   // ipapi.coé™æµé€Ÿç‡
    100,   // Pacificç½‘ç»œAPIé™æµé€Ÿç‡
    100,   // IP9 APIé™æµé€Ÿç‡
    100,   // IPInfo APIé™æµé€Ÿç‡
    100    // XXLB APIé™æµé€Ÿç‡
);

// æŸ¥è¯¢IPä¿¡æ¯
try {
    IpInfo info = engine.query("8.8.8.8");
    System.out.println(info);
} catch (Exception e) {
    e.printStackTrace();
}
```

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### ğŸ”§ è‡ªå®šä¹‰HTTPè¯·æ±‚å¤„ç†å™¨

```java
// åˆ›å»ºè‡ªå®šä¹‰HTTPè¯·æ±‚å¤„ç†å™¨
HttpRequestHandler customHandler = new CustomHttpRequestHandler();

// åˆ›å»ºåŒ…å«æ‰€æœ‰å…è´¹APIæ•°æ®æºçš„æŸ¥è¯¢å¼•æ“ï¼Œä½¿ç”¨è‡ªå®šä¹‰HTTPè¯·æ±‚å¤„ç†å™¨
IpQueryEngine engine = IpQueryEngineFactory.createWithAllFreeApiSources(
    100,  // æ·˜å®APIé™æµé€Ÿç‡
    100,  // ipapi.coé™æµé€Ÿç‡
    100,  // Pacificç½‘ç»œAPIé™æµé€Ÿç‡
    100,  // IP9 APIé™æµé€Ÿç‡
    100,  // IPInfo APIé™æµé€Ÿç‡
    100,  // XXLB APIé™æµé€Ÿç‡
    customHandler // è‡ªå®šä¹‰HTTPè¯·æ±‚å¤„ç†å™¨
);

// æŸ¥è¯¢IPä¿¡æ¯
try {
    IpInfo info = engine.query("8.8.8.8");
    System.out.println(info);
} catch (Exception e) {
    e.printStackTrace();
}
```

### ğŸ§© è‡ªå®šä¹‰æ•°æ®æº

```java
// åˆ›å»ºè‡ªå®šä¹‰æ•°æ®æºåˆ—è¡¨
List<IpSource> sources = new ArrayList<>();
sources.add(new LocalIp2RegionResolver(searcher, 1000, "LocalResolver", 100));
sources.add(new TaobaoIpResolver(100, "TaobaoResolver", 90));

// åˆ›å»ºæŸ¥è¯¢å¼•æ“
IpQueryEngine engine = IpQueryEngineFactory.createWithCustomSources(sources);

// æŸ¥è¯¢IPä¿¡æ¯
try {
    IpInfo info = engine.query("8.8.8.8");
    System.out.println(info);
} catch (Exception e) {
    e.printStackTrace();
}
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

ç»è¿‡æµ‹è¯•ï¼Œåœ¨ç›¸åŒç¯å¢ƒä¸‹ä¸å…¶ä»–è§£å†³æ–¹æ¡ˆçš„æ€§èƒ½å¯¹æ¯”å¦‚ä¸‹ï¼š

| æ–¹æ¡ˆ | å¹³å‡å“åº”æ—¶é—´ | å¹¶å‘å¤„ç†èƒ½åŠ› | å‡†ç¡®ç‡ |
|------|------------|------------|-------|
| çº¯APIè°ƒç”¨ | 320ms | 1,000 QPS | 92% |
| çº¯æœ¬åœ°æ•°æ®åº“ | 0.05ms | 100,000 QPS | 95% |
| Auto IP2Region | 0.1ms | 1,000,000 QPS | 98% |

> æµ‹è¯•ç¯å¢ƒï¼šIntel i7-9750H CPU @ 2.60GHz, 16GB RAM, Windows 11, Java 17

## ğŸ”Œ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„IPæ•°æ®æº

è¦æ·»åŠ ä¸€ä¸ªæ–°çš„IPæ•°æ®æºï¼Œåªéœ€ç»§æ‰¿[AbstractIpSource](src/main/java/cn/hehouhui/ip2region/core/AbstractIpSource.java)ç±»å¹¶å®ç°å¿…è¦çš„æ–¹æ³•ï¼š

```java
public class MyCustomIpResolver extends AbstractIpSource {
    
    public MyCustomIpResolver(double rate, String name, int weight) {
        super(rate, name, weight);
    }
    
    @Override
    protected IpInfo doQuery(String ip) throws Exception {
        // å®ç°å…·ä½“çš„IPæŸ¥è¯¢é€»è¾‘
        // è¿”å›IpInfoå¯¹è±¡
        return new IpInfo(/* å‚æ•° */);
    }
}
```

### è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥

å®ç°[LoadBalancer](src/main/java/cn/hehouhui/ip2region/loadbalancer/LoadBalancer.java)æ¥å£æ¥åˆ›å»ºè‡ªå·±çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼š

```java
public class CustomLoadBalancer implements LoadBalancer {
    
    @Override
    public IpSource select(List<IpSource> sources) {
        // å®ç°è‡ªå®šä¹‰çš„é€‰æ‹©é€»è¾‘
        return sources.get(0); // ç¤ºä¾‹
    }
}
```

## ğŸ“š APIæ–‡æ¡£

è¯¦ç»†APIæ–‡æ¡£è¯·å‚è€ƒ[API_DOCUMENTATION.md](API_DOCUMENTATION.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼å¦‚æœæ‚¨æœ‰ä»»ä½•å»ºè®®æˆ–å‘ç°äº†bugï¼Œè¯·æäº¤[Issue](https://github.com/listener-He/auto-ip2region/issues)æˆ–è€…å‘èµ·[Pull Request](https://github.com/listener-He/auto-ip2region/pulls)ã€‚

### å¼€å‘ç¯å¢ƒæ­å»º

1. å…‹éš†é¡¹ç›®ï¼š`git clone https://github.com/listener-He/auto-ip2region.git`
2. å¯¼å…¥IDEï¼šä½¿ç”¨IntelliJ IDEAæˆ–Eclipseå¯¼å…¥Mavené¡¹ç›®
3. æ„å»ºé¡¹ç›®ï¼š`mvn clean install`

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨Apache License 2.0è®¸å¯è¯ï¼Œè¯¦æƒ…è¯·è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚

## ğŸ’¬ è”ç³»æ–¹å¼

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- é‚®ç®±ï¼šhehouhui@foxmail.com
- GitHub Issuesï¼š[æäº¤é—®é¢˜](https://github.com/listener-He/auto-ip2region/issues)

---
<div align="center">
  Made with â¤ï¸ by Honesty | Â© 2025 All rights reserved
</div>
